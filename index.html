<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sommelier Virtual - Admin Mode</title>
    <style>
        /* Estils previs mantinguts... afegint admin */
        :root { --primary: #6b1111; --secondary: #f4e8e1; --text: #333; --accent: #d4af37; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: sans-serif; }
        body { background-color: var(--secondary); color: var(--text); min-height: 100vh; }
        header { background-color: var(--primary); color: white; padding: 1rem; text-align: center; position: sticky; top: 0; z-index: 100; }
        .container { padding: 2rem; max-width: 600px; margin: 0 auto; width: 100%; }
        .screen { display: none; flex-direction: column; align-items: center; }
        .screen.active { display: flex; }
        .btn { background-color: var(--primary); color: white; border: none; padding: 1rem; border-radius: 12px; width: 100%; margin-bottom: 1rem; cursor: pointer; font-weight: bold; }
        .btn-option { background: white; color: var(--primary); border: 2px solid var(--primary); }
        
        /* Estils Admin */
        #admin-panel { background: white; padding: 20px; border-radius: 15px; width: 100%; display: none; margin-top: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        table { width: 100%; border-collapse: collapse; font-size: 0.8rem; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background: var(--primary); color: white; }
        input, select { padding: 5px; width: 100%; }
        .admin-nav { display: flex; gap: 10px; margin-bottom: 20px; }
        .admin-nav button { flex: 1; padding: 5px; font-size: 0.7rem; }
        .footer-admin { margin-top: 50px; opacity: 0.3; font-size: 0.7rem; cursor: pointer; }
    </style>
</head>
<body>

<header><h2>Sommelier Virtual</h2></header>

<div class="container">
    <div id="screen-start" class="screen active">
        <h1>Troba el teu vi ideal</h1>
        <button class="btn" onclick="goToStep(1)">Començar</button>
        <div class="footer-admin" onclick="showLogin()">Accés Admin</div>
    </div>

    <div id="screen-login" class="screen">
        <h3>Accés Restringit</h3>
        <input type="password" id="admin-pass" placeholder="Contrasenya" style="margin: 20px 0; padding: 10px;">
        <button class="btn" onclick="checkLogin()">Entrar</button>
    </div>

    <div id="screen-admin" class="screen">
        <h2>Administració</h2>
        <div class="admin-nav">
            <button onclick="showSection('vins')">Gestionar Vins</button>
            <button onclick="showSection('combinacions')">Assignacions</button>
            <button onclick="exportConfig()" style="background: green; color: white;">Exportar</button>
        </div>

        <div id="section-vins" class="admin-section">
            <h3>Llista de Vins</h3>
            <div id="table-vins-container"></div>
            <button class="btn" onclick="addWine()" style="margin-top: 10px;">+ Afegir Vi</button>
        </div>

        <div id="section-combinacions" class="admin-section" style="display:none;">
            <h3>Matriu de Respostes</h3>
            <p style="font-size: 0.7rem;">Defineix quin vi apareix per cada Tipus i Estil.</p>
            <div id="table-matrix-container"></div>
        </div>
        
        <button class="btn btn-option" onclick="resetApp()" style="margin-top: 20px;">Sortir</button>
    </div>

    <div id="screen-q1" class="screen">...</div> <div id="screen-results" class="screen">
        <div id="wine-list"></div>
        <button class="btn" onclick="resetApp()">Torna a començar</button>
    </div>
</div>

<script>
    // 1. Base de dades inicial (si no hi ha res a localStorage)
    let defaultVins = [
        { id: 1, nom: "Gramona Imperial", tipus: "Escumós", estil: "Aromàtic", preu: 35, origen: "Corpinnat", any: "2017", desc: "Clàssic elegant." },
        { id: 2, nom: "Recaredo Terrers", tipus: "Escumós", estil: "Sec", preu: 30, origen: "Corpinnat", any: "2018", desc: "Vertical i pur." }
        // ... afegeix els que vulguis per defecte
    ];

    let vins = JSON.parse(localStorage.getItem('vins')) || defaultVins;

    // 2. Lògica de navegació
    function goToStep(step) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        if(step === 1) document.getElementById('screen-q1').classList.add('active');
        // ... lògica simplificada per l'exemple
    }

    function showLogin() {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById('screen-login').classList.add('active');
    }

    function checkLogin() {
        if(document.getElementById('admin-pass').value === "somm") {
            document.getElementById('screen-login').classList.remove('active');
            document.getElementById('screen-admin').classList.add('active');
            renderAdminVins();
            renderMatrix();
        } else {
            alert("Password incorrecte");
        }
    }

    // 3. Gestió de Vins
    function renderAdminVins() {
        let html = `<table><tr><th>Nom</th><th>Tipus</th><th>Preu</th><th>Acció</th></tr>`;
        vins.forEach((v, i) => {
            html += `<tr>
                <td><input value="${v.nom}" onchange="updateWine(${i}, 'nom', this.value)"></td>
                <td><select onchange="updateWine(${i}, 'tipus', this.value)">
                    <option ${v.tipus=='Blanc'?'selected':''}>Blanc</option>
                    <option ${v.tipus=='Negre'?'selected':''}>Negre</option>
                    <option ${v.tipus=='Rosat'?'selected':''}>Rosat</option>
                    <option ${v.tipus=='Escumós'?'selected':''}>Escumós</option>
                </select></td>
                <td><input type="number" value="${v.preu}" onchange="updateWine(${i}, 'preu', this.value)"></td>
                <td><button onclick="deleteWine(${i})">❌</button></td>
            </tr>`;
        });
        html += `</table>`;
        document.getElementById('table-vins-container').innerHTML = html;
    }

    function updateWine(index, field, value) {
        vins[index][field] = value;
        localStorage.setItem('vins', JSON.stringify(vins));
    }

    // 4. Secció de Combinacions (Matriu simplificada per Tipus/Estil)
    function renderMatrix() {
        const tipus = ["Blanc", "Negre", "Rosat", "Escumós"];
        const estils = ["Aromàtic", "Sec"];
        let html = `<table><tr><th>Combinació</th><th>Vi 1</th><th>Vi 2</th></tr>`;
        
        tipus.forEach(t => {
            estils.forEach(e => {
                html += `<tr>
                    <td>${t} - ${e}</td>
                    <td><select>${renderWineOptions()}</select></td>
                    <td><select>${renderWineOptions()}</select></td>
                </tr>`;
            });
        });
        html += `</table>`;
        document.getElementById('table-matrix-container').innerHTML = html;
    }

    function renderWineOptions() {
        return vins.map(v => `<option value="${v.id}">${v.nom}</option>`).join('');
    }

    function showSection(section) {
        document.getElementById('section-vins').style.display = section === 'vins' ? 'block' : 'none';
        document.getElementById('section-combinacions').style.display = section === 'combinacions' ? 'block' : 'none';
    }

    function exportConfig() {
        const data = JSON.stringify(vins);
        console.log("Copia això al teu codi:", data);
        alert("Configuració desada al navegador. Per fer-la permanent a GitHub, hauries d'actualitzar la variable 'defaultVins' al teu fitxer index.html amb el que surt per consola.");
    }

    function resetApp() { location.reload(); }
</script>
</body>
</html>
